exec mo_global.init('M','123');
exec mo_global.set_policy_context('M',123);
excec mo_global.init('SQLAP');

exec fnd_global.apps_initialize(1430,50739,200);

select  NumCptTVA,DateCompta,NumFact,DateFact,NomRaisonFrn,DesgnBienSrv,
MntHT,sum(nvl(TauxTVA,0)) TauxTVA,
sum(nvl(MntTva,0)) MntTva,
sum(nvl(TvaRecup,0)) TvaRecup,
MntHT+sum(nvl(MntTva,0)) MntTTC
from
(
select
gcc.segment2 NumCptTVA,
'XXX' DateCompta,
apinv.invoice_num  NumFact,
to_char(apinv.invoice_date,'DD/MM/YYYY') DateFact,
aps.vendor_name NomRaisonFrn,
apinvl1.description DesgnBienSrv,
apinvl1.amount MntHT,
nvl(zxl.TAX_RATE,0)  TauxTVA,
nvl(zxl.tax_amt,0) MntTva,
nvl(nvl(apinvd2.base_amount,apinvd2.amount),0)  TvaRecup,
'XXX' MntTTC
from 
ap_invoices_all apinv
,ap_invoice_lines_all apinvl1
,AP_INVOICE_DISTRIBUTIONS_all apinvd1
,AP_INVOICE_DISTRIBUTIONS_all apinvd2
,ap_suppliers aps
,ZX_LINES zxl
,gl_code_combinations gcc
 where
  1=1
--and apinv.invoice_id=19000
--and apinv.invoice_num='10016'
and apinvl1.LINE_TYPE_LOOKUP_CODE= 'ITEM'
and apinv.invoice_id=apinvl1.invoice_id
and apinv.vendor_id=aps.vendor_id
and zxl.trx_id(+)=apinv.invoice_id
and zxl.trx_line_number(+)=apinvl1.line_number
and zxl.trx_level_type(+) = 'LINE'
and zxl.CANCEL_FLAG(+) ='N'
and apinv.invoice_id = apinvd1.invoice_id
and apinvl1.line_number=apinvd1.invoice_line_number(+)
and apinv.invoice_id = apinvd2.invoice_id(+)
and apinvd1.invoice_distribution_id = apinvd2.charge_applicable_to_dist_id(+)
and apinvd2.line_type_lookup_code(+) = 'REC_TAX'
and gcc.code_combination_id=apinvd2.DIST_CODE_COMBINATION_ID(+)
)
group by NumCptTVA,DateCompta,NumFact,DateFact,NomRaisonFrn,DesgnBienSrv,MntHT
order by datefact
;

s1 

select * from gl_code_combinations_ where segment2 in ('0998213','0565202');

select * from fnd_flex_value_sets where flex_value_set_id=1017248;

select * from fnd_flex_values_vl where flex_value='0998213';

select * from fnd_flex_values_tl where flex_value_id=62567;
s*

#time# 


-- description gcc seg2
select vv.flex_value,vtl.description from
fnd_flex_values_vl vv,
fnd_flex_values_tl vtl
where vv. flex_value_set_id in (select flex_value_set_id from fnd_flex_value_sets where flex_value_set_name='SGMA_GL_CCF_CPT_SOCIAL')
and vv.flex_value in ('I651105'	,
'0944004'	,
'0566999'	,
'0944009'	,
'0566776'	,
'0566767'	,
'0542999'	,
'IA46010'	,
'0952096'	,
'9100000'	,
'0952915'	,
'0944232'	,
'IA46011'	,
'IA46013'	,
'0564550'	,
'IP22909'	,
'IA43589'	,
'IA34100'	,
'0565700'	,
'0531600'	,
'0564353'	,
'0953012'	,
'0953135'	,
'0944557'	,
'I641793'	,
'0532691'	,
'0952911'	,
'0566050'	,
'IA43230'	,
'0959123'	,
'0567352'	,
'IA43120'	,
'I631000'	,
'IA43560'	,
'0943999'	,
'0572425'	,
'0944006'	,
'0566766'	,
'IRX0001'	,
'IP34110'	,
'IRX0077'	,
'0621401'	,
'I999999'	,
'I643900'	,
'0952882'	,
'0952091'	,
'IX42999'	,
'IA43510'	,
'IX67352'	,
'0944230'	,
'0533530'	,
'0565550'	,
'0565020'	,
'0563350'	,
'0565015'	,
'I643901'	,
'0953220'	,
'0562130'	,
'0564250'	,
'0943218'	,
'0532692'	,
'I641720'	,
'0952083'	,
'IX32999'	,
'I651100'	,
'I651106'	,
'0952230'	,
'0952912'	,
'IA43810'	,
'IA65010'	,
'0952914'	,
'0567052'	,
'0566750'	,
'0945132'	,
'0959999'	,
'0953090'	,
'0566250'	,
'0953230'	,
'0944651'	,
'IA43811'	,
'IX44970'	,
'0953256'	,
'0561566'	,
'0944021'	,
'0566764'	,
'0944231'	,
'0953029'	,
'0952129'	,
'0945999'	,
'0566770'	,
'0572221'	,
'0959991'	,
'0955239'	,
'0566350'	,
'I715525'	,
'0532999'	,
'0944970'	,
'0532690'	,
'IP45999'	,
'9199999'	,
'0566763'	,
'CT43999'	,
'0952988'	,
'I651188'	,
'I712148'	,
'0564500'	,
'IA43540'	,
'0564350'	,
'0566765'	,
'9999999'	,
'0562131'	,
'I642000'	,
'0952086'	,
'0536110'	,
'0952082'	,
'0952120'	,
'0564252'	,
'0564481'	,
'0944246'	,
'IA21330'	,
'0952238'	,
'I642400'	,
'0565021'	,
'I651114'	,
'IA43851'	,
'0564500'	,
'I651114'	,
'I651106'	,
'0542999'	,
'0531600'	,
'0621401'	,
'0944651'	,
'0562130'	,
'0566050'	,
'0955239'	,
'IA46011'	,
'IA46013'	,
'0565550'	,
'IP34110'	,
'IA65010'	,
'0566770'	,
'0564250'	,
'0564481'	,
'0944232'	,
'I715525'	,
'0566764'	,
'0566766'	,
'0566767'	,
'IRX0077'	,
'0953029'	,
'0953220'	,
'0532999'	,
'0565202'	,
'0953256'	,
'0943999'	,
'9199999'	,
'IA43230'	,
'0959123'	,
'0564252'	,
'I631000'	,
'0564550'	,
'IP22909'	,
'IA43589'	,
'0550560'	,
'I651105'	,
'0565700'	,
'0952988'	,
'0567052'	,
'0952129'	,
'0945132'	,
'I642000'	,
'I641793'	,
'0953090'	,
'0952083'	,
'0952238'	,
'0567352'	,
'IA43120'	,
'IX67352'	,
'IA43560'	,
'0565021'	,
'0532690'	,
'0562131'	,
'0952096'	,
'0566750'	,
'0945999'	,
'0572221'	,
'0952086'	,
'0959999'	,
'0952911'	,
'0566250'	,
'I651188'	,
'9100000'	,
'0532691'	,
'0952082'	,
'I712148'	,
'0944246'	,
'0532692'	,
'I641720'	,
'0952882'	,
'IX32999'	,
'IX44970'	,
'0561566'	,
'0565020'	,
'0944004'	,
'0952912'	,
'0566763'	,
'IA43810'	,
'CT43999'	,
'0566999'	,
'0565015'	,
'I643901'	,
'0952230'	,
'0572425'	,
'0944006'	,
'0944009'	,
'0566776'	,
'IA46010'	,
'0953230'	,
'0564353'	,
'0953135'	,
'0944557'	,
'0952120'	,
'0952915'	,
'0943218'	,
'0566350'	,
'0998213'	,
'IA43510'	,
'I651100'	,
'0566765'	,
'IRX0001'	,
'0563350'	,
'9999999'	,
'0944231'	,
'0953012'	,
'0952914'	,
'0536110'	,
'0959991'	,
'I999999'	,
'IX42999'	,
'IA43851'	,
'I642400'	,
'IA34100'	,
'0533530'	,
'IA43540'	,
'0564350'	,
'0944021'	,
'I643900'	,
'IA21330'	,
'0952091'	,
'0944970'	,
'IA43811'	,
'0944031'	,
'0944230'	,
'IP45999'	,
'0564252'	,
'0532692'	,
'0952091'	,
'IA43811'	,
'IA43510'	,
'0565202'	,
'0533530'	,
'CT43999'	,
'0566999'	,
'0566767'	,
'0567052'	,
'0952096'	,
'0945999'	,
'0955239'	,
'0952915'	,
'0944970'	,
'IA46013'	,
'IA43560'	,
'IA34100'	,
'I651106'	,
'0561566'	,
'0565550'	,
'0944006'	,
'0566767'	,
'0563350'	,
'IA65010'	,
'0952914'	,
'0952988'	,
'0536110'	,
'I712148'	,
'0952911'	,
'0959123'	,
'0944246'	,
'0532692'	,
'0952882'	,
'IA46013'	,
'0564550'	,
'0565202'	,
'IP22909'	,
'IA34100'	,
'9199999'	,
'0952230'	,
'0565020'	,
'IRX0001'	,
'0542999'	,
'0952914'	,
'I651188'	,
'0572221'	,
'I642000'	,
'0532691'	,
'0564250'	,
'0566250'	,
'0952914'	,
'0953220'	,
'0945132'	,
'0572221'	,
'9100000'	,
'0536110'	,
'0952082'	,
'0564481'	,
'0944246'	,
'0998213'	,
'I643900'	,
'0952083'	,
'0953256'	,
'0533530'	,
'0550560'	,
'0532690'	,
'I651114'	,
'0572425'	,
'0566766'	,
'CT43999'	,
'0566999'	,
'IRX0001'	,
'0531600'	,
'0621401'	,
'I643901'	,
'0953012'	,
'0952914'	,
'0953029'	,
'0952988'	,
'0952096'	,
'0536110'	,
'0566250'	,
'0952120'	,
'0566350'	,
'0564481'	,
'IA43851'	,
'IA43560'	,
'0565202'	,
'IA43589'	,
'0550560'	,
'0532690'	,
'0952230'	,
'0566766'	,
'0566999'	,
'0944009'	,
'0566776'	,
'0567052'	,
'I651188'	,
'I642000'	,
'I712148'	,
'IX42999'	,
'IA43510'	,
'IA43851'	,
'IA46013'	,
'0565202'	,
'IA34100'	,
'I651114'	,
'0565550'	,
'IA43810'	,
'0531600'	,
'0621401'	,
'0952988'	,
'0567052'	,
'0566770'	,
'0532691'	,
'0952911'	,
'I999999'	,
'0564500'	,
'0564550'	,
'0944230'	,
'0550560'	,
'I651100'	,
'I651106'	,
'0572425'	,
'0953220'	,
'I642000'	,
'0998213'	,
'0564500'	,
'0565015'	,
'0945999'	,
'0952915'	,
'0564500'	,
'0952083'	,
'0532999'	,
'IA43510'	,
'IA43851'	,
'IX44970'	,
'IA43589'	,
'0565021'	,
'0532690'	,
'9199999'	,
'0572425'	,
'0944021'	,
'0944004'	,
'0566764'	,
'0566765'	,
'IA46010'	,
'0532999'	,
'IA43851'	,
'IA46013'	,
'IA43560'	,
'IP22909'	,
'0944031'	,
'9199999'	,
'0572425'	,
'0561566'	,
'0565020'	,
'0566764'	,
'0566766'	,
'CT43999'	,
'IA65010'	,
'0953012'	,
'IA43589'	,
'I651106'	,
'0565550'	,
'0566776'	,
'0952988'	,
'0953220'	,
'0952096'	,
'0566750'	,
'0536110'	,
'0952082'	,
'0944246'	,
'0564500'	,
'0567352'	,
'IA43120'	,
'IA43851'	,
'0953256'	,
'0944031'	,
'IP45999'	,
'I651105'	,
'IA43540'	,
'0565700'	,
'0564350'	,
'0952912'	,
'IRX0001'	,
'IA46010'	,
'I643901'	,
'0564353'	,
'0566750'	,
'0566770'	,
'I651188'	,
'0572221'	,
'0952086'	,
'0959991'	,
'0564250'	,
'0952120'	,
'0564252'	,
'0564481'	,
'0998213'	,
'0564500'	,
'0952091'	,
'IA43120'	,
'IX67352'	,
'IX44970'	,
'0564550'	,
'IA43540'	,
'0565700'	,
'0566763'	,
'IA43810'	,
'IP34110'	,
'0565015'	,
'0953230'	,
'I643901'	,
'0564353'	,
'0945999'	,
'0959999'	,
'0566050'	,
'0952915'	,
'0566350'	,
'0944031'	,
'I651106'	,
'0565020'	,
'0952912'	,
'0566764'	,
'IRX0077'	,
'0953220'	,
'0562130'	,
'0952129'	,
'0945132'	,
'0943218'	,
'0532999'	,
'IX42999'	,
'IA46011'	,
'0564550'	,
'0944031'	,
'I651106'	,
'0566767'	,
'0563350'	,
'0621401'	,
'0953230'	,
'0944651'	,
'0944231'	,
'0945132'	,
'0959991'	,
'0566250'	,
'0959123'	,
'0566350'	,
'0564481'	,
'0998213'	,
'0564500'	,
'0952882'	,
'I643900'	,
'0952091'	,
'IX42999'	,
'IA43811'	,
'IA46011'	,
'0952230'	,
'0566765'	,
'0562131'	,
'0952129'	,
'I651188'	,
'0572221'	,
'0959991'	,
'0566250'	,
'0952120'	,
'0564481'	,
'0944232'	,
'0952083'	,
'0567352'	,
'0532999'	,
'0953256'	,
'I651105'	,
'0952230'	,
'0561566'	,
'0566764'	,
'0566766'	,
'0564353'	,
'0952914'	,
'0952988'	,
'0945999'	,
'I651188'	,
'0532691'	,
'0952120'	,
'I641720'	,
'IA43811'	,
'0565202'	,
'IP22909'	,
'IP45999'	,
'0566776'	,
'0542999'	,
'0531600'	,
'0952988'	,
'0952096'	,
'0952129'	,
'0566770'	,
'0572221'	,
'I642000'	,
'0564250'	,
'I715525'	,
'0998213'	,
'0952238'	,
'0952091'	,
'0953256'	,
'0532690'	,
'0565550'	,
'IRX0001'	,
'0542999'	,
'9999999'	,
'0953230'	,
'I643901'	,
'0953135'	,
'0567052'	,
'0945999'	,
'I641793'	,
'0952086'	,
'0952911'	,
'I715525'	,
'IA43120'	,
'IA43510'	,
'0565202'	,
'IA46011'	,
'IX32999'	,
'0952230'	,
'0566999'	,
'0621401'	,
'0567052'	,
'0952096'	,
'IX67352'	,
'I631000'	,
'0533530'	,
'0532690'	,
'I651114'	,
'IA43540'	,
'0564350'	,
'0944021'	,
'0566767'	,
'0563350'	,
'IA65010'	,
'0621401'	,
'I643901'	,
'0564353'	,
'0952911'	,
'0952915'	,
'0532999'	,
'IX32999'	,
'IX44970'	,
'0564550'	,
'IA34100'	,
'9199999'	,
'I651114'	,
'0565020'	,
'0566776'	,
'9999999'	,
'0562131'	,
'I642000'	,
'0952082'	,
'0952911'	,
'0952083'	,
'IA46011'	,
'0564550'	,
'0565021'	,
'0943999'	,
'I651106'	,
'IA43560'	,
'IA34100'	,
'0943999'	,
'0561566'	)
and vv.flex_value_id=vtl.flex_value_id
and vtl.language='F'
;

select line_type_lookup_code,amount,x.* from AP_INVOICE_DISTRIBUTIONS_all x
where invoice_id=17007
and line_type_lookup_code(+) = 'REC_TAX'
;
select * from ap_invoice_lines_all where invoice_id=11001;


select * from  AP_INVOICE_DISTRIBUTIONS_V;

select * from ap_invoice_distributions_all
where invoice_id=11001
--and line_type_lookup_code='REC_TAX'
;

exec mo_global.

select * from all_policies where object_name like 'AP_INVOICE_DISTRIBUTIONS';

select * from AP_INVOICE_DISTRIBUTIONS

select * from dba_tables where 1=1
and table_name like '%PLAN_TABLE%'
;

select * from PLAN_TABLE;

 